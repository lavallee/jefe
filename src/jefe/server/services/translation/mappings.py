"""Mappings between harness configuration formats.

This module defines the mappings used for translating between different
AI coding assistant configuration formats.
"""

from __future__ import annotations

from typing import Literal

# Settings file format types
SettingsFormat = Literal["json", "toml"]


# Canonical harness names and their aliases
HARNESS_ALIASES: dict[str, str] = {
    # Claude Code aliases
    "claude_code": "claude-code",
    "claude": "claude-code",
    "claudecode": "claude-code",
    # Codex CLI aliases
    "codex": "codex_cli",
    "codexcli": "codex_cli",
    "openai_codex": "codex_cli",
    # OpenCode aliases
    "open_code": "opencode",
    # Gemini CLI aliases
    "gemini": "gemini_cli",
    "geminicli": "gemini_cli",
    "google_gemini": "gemini_cli",
}


# Section heading mappings for instruction files (Markdown)
# Structure: source_harness -> target_harness -> source_heading -> target_heading
INSTRUCTION_SECTION_MAPPINGS: dict[str, dict[str, dict[str, str]]] = {
    "claude-code": {
        "codex_cli": {
            # Common sections
            "project overview": "Overview",
            "getting started": "Getting Started",
            "development": "Development",
            "build": "Build",
            "test": "Test",
            "commands": "Commands",
            "conventions": "Coding Conventions",
            "code style": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment": "Environment Variables",
            "api": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            # Claude-specific -> Codex equivalents
            "agent instructions": "Agent Instructions",
            "memory": "Context",
            "important files": "Key Files",
        },
        "opencode": {
            "project overview": "Project Overview",
            "getting started": "Getting Started",
            "development": "Development Setup",
            "build": "Building",
            "test": "Testing",
            "commands": "Available Commands",
            "conventions": "Code Conventions",
            "code style": "Style Guide",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment": "Environment",
            "api": "API Reference",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "agent instructions": "Instructions",
            "memory": "Context",
            "important files": "Important Files",
        },
        "gemini_cli": {
            "project overview": "Project Overview",
            "getting started": "Getting Started",
            "development": "Development",
            "build": "Build",
            "test": "Test",
            "commands": "Commands",
            "conventions": "Conventions",
            "code style": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment": "Environment Variables",
            "api": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "agent instructions": "Instructions",
            "memory": "Context",
            "important files": "Important Files",
        },
    },
    "codex_cli": {
        "claude-code": {
            "overview": "Project Overview",
            "getting started": "Getting Started",
            "development": "Development",
            "build": "Build",
            "test": "Test",
            "commands": "Commands",
            "coding conventions": "Conventions",
            "code style": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment variables": "Environment",
            "api": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "agent instructions": "Agent Instructions",
            "context": "Memory",
            "key files": "Important Files",
        },
        "opencode": {
            "overview": "Project Overview",
            "getting started": "Getting Started",
            "development": "Development Setup",
            "build": "Building",
            "test": "Testing",
            "commands": "Available Commands",
            "coding conventions": "Code Conventions",
            "code style": "Style Guide",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment variables": "Environment",
            "api": "API Reference",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "agent instructions": "Instructions",
            "context": "Context",
            "key files": "Important Files",
        },
        "gemini_cli": {
            "overview": "Project Overview",
            "getting started": "Getting Started",
            "development": "Development",
            "build": "Build",
            "test": "Test",
            "commands": "Commands",
            "coding conventions": "Conventions",
            "code style": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment variables": "Environment Variables",
            "api": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "agent instructions": "Instructions",
            "context": "Context",
            "key files": "Important Files",
        },
    },
    "opencode": {
        "claude-code": {
            "project overview": "Project Overview",
            "getting started": "Getting Started",
            "development setup": "Development",
            "building": "Build",
            "testing": "Test",
            "available commands": "Commands",
            "code conventions": "Conventions",
            "style guide": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment": "Environment",
            "api reference": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "instructions": "Agent Instructions",
            "context": "Memory",
            "important files": "Important Files",
        },
        "codex_cli": {
            "project overview": "Overview",
            "getting started": "Getting Started",
            "development setup": "Development",
            "building": "Build",
            "testing": "Test",
            "available commands": "Commands",
            "code conventions": "Coding Conventions",
            "style guide": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment": "Environment Variables",
            "api reference": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "instructions": "Agent Instructions",
            "context": "Context",
            "important files": "Key Files",
        },
        "gemini_cli": {
            "project overview": "Project Overview",
            "getting started": "Getting Started",
            "development setup": "Development",
            "building": "Build",
            "testing": "Test",
            "available commands": "Commands",
            "code conventions": "Conventions",
            "style guide": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment": "Environment Variables",
            "api reference": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "instructions": "Instructions",
            "context": "Context",
            "important files": "Important Files",
        },
    },
    "gemini_cli": {
        "claude-code": {
            "project overview": "Project Overview",
            "getting started": "Getting Started",
            "development": "Development",
            "build": "Build",
            "test": "Test",
            "commands": "Commands",
            "conventions": "Conventions",
            "code style": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment variables": "Environment",
            "api": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "instructions": "Agent Instructions",
            "context": "Memory",
            "important files": "Important Files",
        },
        "codex_cli": {
            "project overview": "Overview",
            "getting started": "Getting Started",
            "development": "Development",
            "build": "Build",
            "test": "Test",
            "commands": "Commands",
            "conventions": "Coding Conventions",
            "code style": "Code Style",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment variables": "Environment Variables",
            "api": "API",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "instructions": "Agent Instructions",
            "context": "Context",
            "important files": "Key Files",
        },
        "opencode": {
            "project overview": "Project Overview",
            "getting started": "Getting Started",
            "development": "Development Setup",
            "build": "Building",
            "test": "Testing",
            "commands": "Available Commands",
            "conventions": "Code Conventions",
            "code style": "Style Guide",
            "architecture": "Architecture",
            "dependencies": "Dependencies",
            "environment variables": "Environment",
            "api": "API Reference",
            "deployment": "Deployment",
            "troubleshooting": "Troubleshooting",
            "instructions": "Instructions",
            "context": "Context",
            "important files": "Important Files",
        },
    },
}


# Settings key mappings between harness formats
# Structure: source_harness -> target_harness -> source_key -> target_key
# None as target_key means the setting is not supported/should be skipped
SETTINGS_KEY_MAPPINGS: dict[str, dict[str, dict[str, str | None]]] = {
    "claude-code": {
        "codex_cli": {
            # API configuration
            "apiKey": "api_key",
            "model": "model",
            "provider": "provider",
            # Behavior settings
            "autoApprove": "auto_approve",
            "autoApprovePatterns": None,  # Not supported in Codex
            "maxTokens": "max_tokens",
            "temperature": "temperature",
            # Project settings
            "workspaceRoot": "workspace_root",
            "ignoredPaths": "ignored_paths",
            # Memory/context
            "persistMemory": None,  # Codex handles this differently
            "memoryPath": None,
        },
        "opencode": {
            "apiKey": "api_key",
            "model": "model",
            "provider": "provider",
            "autoApprove": "auto_approve",
            "autoApprovePatterns": "auto_approve_patterns",
            "maxTokens": "max_tokens",
            "temperature": "temperature",
            "workspaceRoot": "working_directory",
            "ignoredPaths": "ignore_patterns",
            "persistMemory": "persist_context",
            "memoryPath": "context_path",
        },
        "gemini_cli": {
            "apiKey": "api_key",
            "model": "model",
            "provider": None,  # Gemini-only
            "autoApprove": "autoApprove",
            "autoApprovePatterns": None,
            "maxTokens": "maxTokens",
            "temperature": "temperature",
            "workspaceRoot": "workspaceRoot",
            "ignoredPaths": "ignoredPaths",
            "persistMemory": "persistMemory",
            "memoryPath": "memoryPath",
        },
    },
    "codex_cli": {
        "claude-code": {
            "api_key": "apiKey",
            "model": "model",
            "provider": "provider",
            "auto_approve": "autoApprove",
            "max_tokens": "maxTokens",
            "temperature": "temperature",
            "workspace_root": "workspaceRoot",
            "ignored_paths": "ignoredPaths",
        },
        "opencode": {
            "api_key": "api_key",
            "model": "model",
            "provider": "provider",
            "auto_approve": "auto_approve",
            "max_tokens": "max_tokens",
            "temperature": "temperature",
            "workspace_root": "working_directory",
            "ignored_paths": "ignore_patterns",
        },
        "gemini_cli": {
            "api_key": "api_key",
            "model": "model",
            "provider": None,
            "auto_approve": "autoApprove",
            "max_tokens": "maxTokens",
            "temperature": "temperature",
            "workspace_root": "workspaceRoot",
            "ignored_paths": "ignoredPaths",
        },
    },
    "opencode": {
        "claude-code": {
            "api_key": "apiKey",
            "model": "model",
            "provider": "provider",
            "auto_approve": "autoApprove",
            "auto_approve_patterns": "autoApprovePatterns",
            "max_tokens": "maxTokens",
            "temperature": "temperature",
            "working_directory": "workspaceRoot",
            "ignore_patterns": "ignoredPaths",
            "persist_context": "persistMemory",
            "context_path": "memoryPath",
        },
        "codex_cli": {
            "api_key": "api_key",
            "model": "model",
            "provider": "provider",
            "auto_approve": "auto_approve",
            "auto_approve_patterns": None,
            "max_tokens": "max_tokens",
            "temperature": "temperature",
            "working_directory": "workspace_root",
            "ignore_patterns": "ignored_paths",
            "persist_context": None,
            "context_path": None,
        },
        "gemini_cli": {
            "api_key": "api_key",
            "model": "model",
            "provider": None,
            "auto_approve": "autoApprove",
            "auto_approve_patterns": None,
            "max_tokens": "maxTokens",
            "temperature": "temperature",
            "working_directory": "workspaceRoot",
            "ignore_patterns": "ignoredPaths",
            "persist_context": "persistMemory",
            "context_path": "memoryPath",
        },
    },
    "gemini_cli": {
        "claude-code": {
            "api_key": "apiKey",
            "model": "model",
            "autoApprove": "autoApprove",
            "maxTokens": "maxTokens",
            "temperature": "temperature",
            "workspaceRoot": "workspaceRoot",
            "ignoredPaths": "ignoredPaths",
            "persistMemory": "persistMemory",
            "memoryPath": "memoryPath",
        },
        "codex_cli": {
            "api_key": "api_key",
            "model": "model",
            "autoApprove": "auto_approve",
            "maxTokens": "max_tokens",
            "temperature": "temperature",
            "workspaceRoot": "workspace_root",
            "ignoredPaths": "ignored_paths",
            "persistMemory": None,
            "memoryPath": None,
        },
        "opencode": {
            "api_key": "api_key",
            "model": "model",
            "autoApprove": "auto_approve",
            "maxTokens": "max_tokens",
            "temperature": "temperature",
            "workspaceRoot": "working_directory",
            "ignoredPaths": "ignore_patterns",
            "persistMemory": "persist_context",
            "memoryPath": "context_path",
        },
    },
}
